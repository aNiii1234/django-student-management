{% load static %}
<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}å­¦ç”Ÿç®¡ç†ç³»ç»Ÿ{% endblock %}</title>

    <!-- CSSæ ·å¼æ–‡ä»¶ -->
    <link rel="stylesheet" href="{% static 'css/clean-advanced.css' %}">
    <link rel="stylesheet" href="{% static 'css/mobile-responsive.css' %}">

    <!-- ç®€åŒ–çš„ä¸»é¢˜åˆ‡æ¢è„šæœ¬ -->
    <script>
        // å¿«é€Ÿä¸»é¢˜åˆ‡æ¢ï¼Œæ— åŠ¨ç”»
        (function() {
            const theme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', theme);

            // ç®€å•çš„åˆ‡æ¢å‡½æ•°
            window.toggleTheme = function() {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                document.documentElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
            };
        })();
    </script>
</head>
<body>
    <!-- ç®€åŒ–çš„å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="container" style="max-width: 1200px; margin: 0 auto; padding: 0 1rem; display: flex; justify-content: space-between; align-items: center;">
            <div class="d-flex-center gap-3">
                <a href="{% url 'students:home' %}" class="navbar-brand">
                    å­¦ç”Ÿç®¡ç†ç³»ç»Ÿ
                </a>
            </div>

            <div class="d-flex-center gap-2">
                {% if user.is_authenticated %}
                    <span style="color: var(--text-secondary); margin-right: 1rem;">
                        æ¬¢è¿, {{ user.get_full_name|default:user.username }}
                    </span>
                    <a href="{% url 'accounts:logout' %}" class="btn btn-sm btn-outline">é€€å‡º</a>
                {% else %}
                    <a href="{% url 'accounts:login' %}" class="btn btn-sm btn-primary">ç™»å½•</a>
                    <a href="{% url 'accounts:register' %}" class="btn btn-sm btn-outline">æ³¨å†Œ</a>
                {% endif %}

                <!-- ç®€åŒ–çš„ä¸»é¢˜åˆ‡æ¢æŒ‰é’® -->
                <button onclick="toggleTheme()" class="btn btn-sm" style="background: transparent; border: 1px solid var(--border-color); color: var(--text-primary);">
                    <span id="theme-icon">ğŸŒ™</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- æ¶ˆæ¯æ˜¾ç¤º -->
    {% if messages %}
        <div style="max-width: 1200px; margin: 1rem auto; padding: 0 1rem;">
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }} mb-2">
                    {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <!-- ä¸»è¦å†…å®¹ -->
    <main style="min-height: calc(100vh - 200px);">
        {% block content %}
        {% endblock %}
    </main>

    <!-- ç®€åŒ–çš„é¡µè„š -->
    <footer style="background: var(--bg-secondary); border-top: 1px solid var(--border-color); padding: 2rem 0; margin-top: 3rem;">
        <div class="container" style="max-width: 1200px; margin: 0 auto; padding: 0 1rem; text-align: center;">
            <p style="color: var(--text-muted); margin: 0;">
                Â© 2024 å­¦ç”Ÿç®¡ç†ç³»ç»Ÿ. ä½¿ç”¨ Django æ„å»º.
            </p>
        </div>
    </footer>

    <!-- æœ€å°åŒ–çš„JavaScript -->
    <script>
        // æ›´æ–°ä¸»é¢˜å›¾æ ‡
        function updateThemeIcon() {
            const icon = document.getElementById('theme-icon');
            const theme = document.documentElement.getAttribute('data-theme');
            icon.textContent = theme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ›´æ–°å›¾æ ‡
        document.addEventListener('DOMContentLoaded', updateThemeIcon);

        // ç›‘å¬ä¸»é¢˜åˆ‡æ¢
        const observer = new MutationObserver(updateThemeIcon);
        observer.observe(document.documentElement, {
            attributes: true,
            attributeFilter: ['data-theme']
        });
    </script>
</body>
</html>