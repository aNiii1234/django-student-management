{% extends 'base-advanced.html' %}
{% load static %}
{% block title %}é«˜çº§å­¦ç”Ÿæ¡£æ¡ˆç®¡ç† - å­¦ç”Ÿä¿¡æ¯ç®¡ç†ç³»ç»Ÿ{% endblock %}

{% block content %}
<!-- é«˜çº§é¡µé¢å¤´éƒ¨ -->
<div class="row mb-5 fade-in-up">
    <div class="col-12">
        <div class="glass-card p-4 p-lg-5">
            <div class="row align-items-center">
                <div class="col-lg-8">
                    <div class="page-header">
                        <h1 class="text-gradient mb-3">
                            <i class="fas fa-users-gear me-3"></i>
                            é«˜çº§å­¦ç”Ÿæ¡£æ¡ˆä¸­å¿ƒ
                        </h1>
                        <p class="lead text-secondary mb-4">
                            é‡‡ç”¨å…ˆè¿›æŠ€æœ¯å’Œç°ä»£è®¾è®¡ç†å¿µï¼Œä¸ºå­¦ç”Ÿä¿¡æ¯ç®¡ç†æä¾›å…¨æ–°ä½“éªŒã€‚
                            æ”¯æŒæ™ºèƒ½æœç´¢ã€å®æ—¶åˆ†æå’Œå¤šç»´åº¦æ•°æ®å¯è§†åŒ–ã€‚
                        </p>
                        <div class="d-flex flex-wrap gap-2 mb-4">
                            <div class="badge-advanced badge-info-gradient">
                                <i class="fas fa-brain me-1"></i> AI æ™ºèƒ½åˆ†æ
                            </div>
                            <div class="badge-advanced badge-success-gradient">
                                <i class="fas fa-shield-alt me-1"></i> å®‰å…¨åŠ å¯†
                            </div>
                            <div class="badge-advanced badge-warning-gradient">
                                <i class="fas fa-rocket me-1"></i> é«˜æ€§èƒ½
                            </div>
                            <div class="badge-advanced badge-danger-gradient">
                                <i class="fas fa-mobile-alt me-1"></i> å“åº”å¼è®¾è®¡
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 text-lg-end mt-4 mt-lg-0">
                    <div class="action-buttons">
                        <a href="{% url 'students:student_profile_create' %}" class="btn btn-primary-gradient btn-lg me-2 hover-lift">
                            <i class="fas fa-user-plus me-2"></i>
                            æ·»åŠ å­¦ç”Ÿ
                        </a>
                        {% if user.role == 'admin' %}
                            <button class="btn btn-glass btn-lg" onclick="toggleAdvancedPanel()">
                                <i class="fas fa-cog"></i>
                            </button>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- é«˜çº§æ§åˆ¶é¢æ¿ -->
<div id="advancedPanel" class="row mb-4 fade-in-up delay-200" style="display: none;">
    <div class="col-12">
        <div class="glass-card p-4">
            <div class="row g-4">
                <!-- é«˜çº§æœç´¢ -->
                <div class="col-lg-6">
                    <div class="search-advanced">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" class="form-control form-control-advanced"
                               id="advancedSearch" placeholder="é«˜çº§æœç´¢ï¼šå§“åã€å­¦å·ã€é™¢ç³»ã€ä¸“ä¸š..."
                               value="{{ request.GET.search|default:'' }}">
                    </div>
                    <div class="mt-3">
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" id="fuzzySearch">
                            <label class="form-check-label text-secondary" for="fuzzySearch">
                                æ¨¡ç³Šæœç´¢
                            </label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" id="realtimeSearch" checked>
                            <label class="form-check-label text-secondary" for="realtimeSearch">
                                å®æ—¶æœç´¢
                            </label>
                        </div>
                    </div>
                </div>

                <!-- é«˜çº§ç­›é€‰ -->
                <div class="col-lg-6">
                    <div class="row g-3">
                        <div class="col-md-4">
                            <select class="form-select form-control-advanced" id="statusFilter">
                                <option value="">æ‰€æœ‰çŠ¶æ€</option>
                                <option value="enrolled">åœ¨è¯»</option>
                                <option value="suspended">ä¼‘å­¦</option>
                                <option value="graduated">å·²æ¯•ä¸š</option>
                                <option value="dropped_out">é€€å­¦</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <select class="form-select form-control-advanced" id="genderFilter">
                                <option value="">æ‰€æœ‰æ€§åˆ«</option>
                                <option value="M">ç”·</option>
                                <option value="F">å¥³</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <select class="form-select form-control-advanced" id="sortBy">
                                <option value="created_at">åˆ›å»ºæ—¶é—´</option>
                                <option value="student_id">å­¦å·</option>
                                <option value="real_name">å§“å</option>
                                <option value="enrollment_status">å­¦ç±çŠ¶æ€</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- é«˜çº§ç»Ÿè®¡å¡ç‰‡ -->
<div class="row g-4 mb-5">
    <div class="col-xl-3 col-lg-6 fade-in-up delay-100">
        <div class="stats-card hover-lift">
            <div class="stats-number" data-count="{{ students.count }}">{{ students.count }}</div>
            <div class="stats-label">
                <i class="fas fa-users me-2"></i>å­¦ç”Ÿæ€»æ•°
            </div>
        </div>
    </div>
    <div class="col-xl-3 col-lg-6 fade-in-up delay-200">
        <div class="stats-card hover-lift">
            <div class="stats-number" data-count="{{ page_obj.paginator.num_pages }}">{{ page_obj.paginator.num_pages }}</div>
            <div class="stats-label">
                <i class="fas fa-file-alt me-2"></i>æ€»é¡µæ•°
            </div>
        </div>
    </div>
    <div class="col-xl-3 col-lg-6 fade-in-up delay-300">
        <div class="stats-card hover-lift">
            <div class="stats-number" data-count="{{ page_obj.number }}">{{ page_obj.number }}</div>
            <div class="stats-label">
                <i class="fas fa-bookmark me-2"></i>å½“å‰é¡µ
            </div>
        </div>
    </div>
    <div class="col-xl-3 col-lg-6 fade-in-up delay-400">
        <div class="stats-card hover-lift">
            <div class="stats-number">
                <i class="fas fa-chart-line"></i>
            </div>
            <div class="stats-label">
                <i class="fas fa-trending-up me-2"></i>å®æ—¶åˆ†æ
            </div>
        </div>
    </div>
</div>

<!-- å­¦ç”Ÿå¡ç‰‡ç½‘æ ¼ -->
<div class="row g-4 mb-5" id="studentsGrid">
    {% if students %}
        {% for student in students %}
            <div class="col-xl-4 col-lg-6 fade-in-up" style="animation-delay: {{ forloop.counter0|floatformat:2 }}s;">
                <div class="student-card-advanced hover-glow">
                    <!-- å¡ç‰‡å¤´éƒ¨ -->
                    <div class="card-header-advanced p-4">
                        <div class="d-flex align-items-center justify-content-between">
                            <div class="d-flex align-items-center">
                                <div class="avatar-advanced me-3" style="width: 60px; height: 60px; font-size: 1.5rem;">
                                    {{ student.real_name.0|upper }}
                                </div>
                                <div>
                                    <h5 class="mb-1 text-white">{{ student.real_name }}</h5>
                                    <p class="mb-0 opacity-75">{{ student.student_id }}</p>
                                </div>
                            </div>
                            <div class="dropdown">
                                <button class="btn btn-glass btn-sm" data-bs-toggle="dropdown">
                                    <i class="fas fa-ellipsis-v"></i>
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li><a href="{% url 'students:student_profile_update' student.pk %}" class="dropdown-item">
                                        <i class="fas fa-edit me-2"></i>ç¼–è¾‘æ¡£æ¡ˆ
                                    </a></li>
                                    <li><a href="{% url 'students:student_profile_delete' student.pk %}" class="dropdown-item text-danger">
                                        <i class="fas fa-trash me-2"></i>åˆ é™¤æ¡£æ¡ˆ
                                    </a></li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- å¡ç‰‡ä¸»ä½“ -->
                    <div class="card-body-advanced p-4">
                        <!-- åŸºæœ¬ä¿¡æ¯ -->
                        <div class="row g-3 mb-4">
                            <div class="col-6">
                                <div class="info-item">
                                    <i class="fas fa-venus-mars text-info"></i>
                                    <span class="label">æ€§åˆ«</span>
                                    <span class="value">
                                        {% if student.gender == 'F' %}
                                            <div class="badge-advanced badge-danger-gradient">å¥³</div>
                                        {% elif student.gender == 'M' %}
                                            <div class="badge-advanced badge-info-gradient">ç”·</div>
                                        {% else %}
                                            <div class="badge-advanced badge-secondary">--</div>
                                        {% endif %}
                                    </span>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="info-item">
                                    <i class="fas fa-birthday-cake text-warning"></i>
                                    <span class="label">ç”Ÿæ—¥</span>
                                    <span class="value">{{ student.birth_date|date:'m/d'|default:'--' }}</span>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="info-item">
                                    <i class="fas fa-phone text-primary"></i>
                                    <span class="label">ç”µè¯</span>
                                    <span class="value">{{ student.phone|default:'--' }}</span>
                                </div>
                            </div>
                        </div>

                        <!-- çŠ¶æ€ä¿¡æ¯ -->
                        <div class="status-section mb-4">
                            <h6 class="text-secondary mb-3">å­¦ç±çŠ¶æ€</h6>
                            <div class="status-badge">
                                {% if student.enrollment_status == 'enrolled' %}
                                    <div class="badge-advanced badge-success-gradient me-2">
                                        <i class="fas fa-check-circle me-1"></i>åœ¨è¯»
                                    </div>
                                {% elif student.enrollment_status == 'suspended' %}
                                    <div class="badge-advanced badge-warning-gradient me-2">
                                        <i class="fas fa-pause-circle me-1"></i>ä¼‘å­¦
                                    </div>
                                {% elif student.enrollment_status == 'graduated' %}
                                    <div class="badge-advanced badge-info-gradient me-2">
                                        <i class="fas fa-graduation-cap me-1"></i>å·²æ¯•ä¸š
                                    </div>
                                {% elif student.enrollment_status == 'dropped_out' %}
                                    <div class="badge-advanced badge-danger-gradient me-2">
                                        <i class="fas fa-times-circle me-1"></i>é€€å­¦
                                    </div>
                                {% elif student.enrollment_status == 'transferred' %}
                                    <div class="badge-advanced badge-primary-gradient me-2">
                                        <i class="fas fa-exchange-alt me-1"></i>è½¬å‡º
                                    </div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- å­¦æœ¯ä¿¡æ¯ -->
                        <div class="academic-section">
                            <h6 class="text-secondary mb-3">å­¦æœ¯ä¿¡æ¯</h6>
                            <div class="row g-3">
                                <div class="col-12">
                                    <div class="info-item">
                                        <i class="fas fa-building text-info"></i>
                                        <span class="label">é™¢ç³»</span>
                                        <span class="value">{{ student.department.name|default:'--' }}</span>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="info-item">
                                        <i class="fas fa-book text-success"></i>
                                        <span class="label">ä¸“ä¸š</span>
                                        <span class="value">{{ student.major.name|default:'--' }}</span>
                                    </div>
                                </div>
                                {% if student.bio %}
                                    <div class="col-12">
                                        <div class="info-item">
                                            <i class="fas fa-user-tag text-warning"></i>
                                            <span class="label">ä¸ªäººç®€ä»‹</span>
                                            <span class="value bio-text">{{ student.bio|truncatechars:50 }}</span>
                                        </div>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- å¡ç‰‡åº•éƒ¨ -->
                    <div class="card-footer-advanced p-3">
                        <div class="d-flex justify-content-between align-items-center">
                            <small class="text-muted">
                                <i class="fas fa-clock me-1"></i>
                                åˆ›å»ºäº {{ student.created_at|date:'Y-m-d' }}
                            </small>
                            <div class="action-buttons">
                                <a href="{% url 'students:student_profile_update' student.pk %}"
                                   class="btn btn-glass btn-sm me-1" title="ç¼–è¾‘">
                                    <i class="fas fa-edit"></i>
                                </a>
                                <a href="{% url 'students:student_profile_delete' student.pk %}"
                                   class="btn btn-glass btn-sm text-danger" title="åˆ é™¤">
                                    <i class="fas fa-trash"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% endfor %}
    {% else %}
        <!-- ç©ºçŠ¶æ€ -->
        <div class="col-12">
            <div class="empty-state-advanced text-center py-5">
                <div class="empty-icon mb-4">
                    <i class="fas fa-users-slash fa-4x text-muted"></i>
                </div>
                <h3 class="text-gradient mb-3">æš‚æ— å­¦ç”Ÿæ•°æ®</h3>
                <p class="text-secondary mb-4">
                    å¼€å§‹æ·»åŠ å­¦ç”Ÿæ¡£æ¡ˆï¼Œè®©é«˜çº§ç®¡ç†ç³»ç»Ÿå¸®åŠ©ä½ é«˜æ•ˆç®¡ç†å­¦ç”Ÿä¿¡æ¯ã€‚
                    ç³»ç»Ÿæ”¯æŒæ‰¹é‡å¯¼å…¥ã€æ™ºèƒ½åˆ†æå’Œå®æ—¶æ•°æ®åŒæ­¥ã€‚
                </p>
                <a href="{% url 'students:student_profile_create' %}" class="btn btn-primary-gradient btn-lg hover-lift">
                    <i class="fas fa-user-plus me-2"></i>
                    æ·»åŠ ç¬¬ä¸€ä¸ªå­¦ç”Ÿ
                </a>
            </div>
        </div>
    {% endif %}
</div>

<!-- é«˜çº§åˆ†é¡µ -->
{% if is_paginated %}
<div class="row fade-in-up delay-500">
    <div class="col-12">
        <div class="glass-card p-4">
            <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
                <div class="page-info">
                    <span class="text-secondary">
                        æ˜¾ç¤ºç¬¬ <strong>{{ page_obj.start_index }}</strong> -
                        <strong>{{ page_obj.end_index }}</strong> æ¡ï¼Œ
                        å…± <strong>{{ page_obj.paginator.count }}</strong> æ¡è®°å½•
                    </span>
                </div>

                <nav class="pagination-advanced" aria-label="å­¦ç”Ÿåˆ—è¡¨åˆ†é¡µ">
                    {% if page_obj.has_previous %}
                        <a href="?page=1" class="page-link" title="é¦–é¡µ">
                            <i class="fas fa-angle-double-left"></i>
                        </a>
                        <a href="?page={{ page_obj.previous_page_number }}" class="page-link" title="ä¸Šä¸€é¡µ">
                            <i class="fas fa-angle-left"></i>
                        </a>
                    {% endif %}

                    <div class="page-current">
                        <span class="page-link active">
                            {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}
                        </span>
                    </div>

                    {% if page_obj.has_next %}
                        <a href="?page={{ page_obj.next_page_number }}" class="page-link" title="ä¸‹ä¸€é¡µ">
                            <i class="fas fa-angle-right"></i>
                        </a>
                        <a href="?page={{ page_obj.paginator.num_pages }}" class="page-link" title="æœ«é¡µ">
                            <i class="fas fa-angle-double-right"></i>
                        </a>
                    {% endif %}
                </nav>

                <div class="page-size-selector">
                    <select class="form-select form-control-advanced" id="pageSize" style="width: auto;">
                        <option value="12">12/é¡µ</option>
                        <option value="24">24/é¡µ</option>
                        <option value="48">48/é¡µ</option>
                        <option value="96">96/é¡µ</option>
                    </select>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- è‡ªå®šä¹‰æ ·å¼ -->
<style>
    /* é«˜çº§å­¦ç”Ÿå¡ç‰‡ */
    .student-card-advanced {
        background: var(--glass-bg);
        backdrop-filter: var(--glass-blur);
        border-radius: var(--radius-2xl);
        border: 1px solid var(--glass-border-light);
        box-shadow: var(--glass-shadow);
        transition: all 0.5s cubic-bezier(0.4, 0.0, 0.2, 1);
        position: relative;
        overflow: hidden;
        height: 100%;
        display: flex;
        flex-direction: column;
    }

    .student-card-advanced::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
        animation: cardShine 6s linear infinite;
    }

    @keyframes cardShine {
        0% { left: -100%; }
        100% { left: 100%; }
    }

    .student-card-advanced:hover {
        transform: translateY(-15px) scale(1.02);
        box-shadow:
            var(--glass-shadow),
            0 25px 50px rgba(0, 0, 0, 0.2),
            0 0 40px rgba(102, 126, 234, 0.3);
        border-color: rgba(102, 126, 234, 0.4);
    }

    .card-body-advanced {
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .card-footer-advanced {
        background: rgba(255, 255, 255, 0.05);
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        margin-top: auto;
    }

    /* ä¿¡æ¯é¡¹æ ·å¼ */
    .info-item {
        display: flex;
        flex-direction: column;
        padding: var(--space-sm);
        background: rgba(255, 255, 255, 0.03);
        border-radius: var(--radius);
        transition: all 0.3s ease;
    }

    .info-item:hover {
        background: rgba(255, 255, 255, 0.08);
        transform: translateX(5px);
    }

    .info-item .label {
        font-size: 0.75rem;
        color: var(--text-muted);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: var(--space-xs);
    }

    .info-item .value {
        font-size: 0.9rem;
        color: var(--text-primary);
        font-weight: 500;
    }

    .info-item i {
        margin-bottom: var(--space-xs);
        font-size: 1rem;
    }

    /* çŠ¶æ€éƒ¨åˆ† */
    .status-section,
    .academic-section {
        background: rgba(255, 255, 255, 0.03);
        border-radius: var(--radius);
        padding: var(--space-md);
        margin-bottom: var(--space-md);
    }

    .status-section h6,
    .academic-section h6 {
        font-size: 0.875rem;
        font-weight: 600;
        margin-bottom: var(--space-sm);
        display: flex;
        align-items: center;
    }

    .bio-text {
        line-height: 1.4;
        max-height: 3.6rem;
        overflow: hidden;
        position: relative;
    }

    .bio-text::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 1.2rem;
        background: linear-gradient(transparent, rgba(255, 255, 255, 0.1));
    }

    /* é«˜çº§ç©ºçŠ¶æ€ */
    .empty-state-advanced {
        background: var(--glass-bg);
        backdrop-filter: var(--glass-blur);
        border-radius: var(--radius-2xl);
        border: 1px solid var(--glass-border-light);
        box-shadow: var(--glass-shadow);
        padding: var(--space-3xl);
        position: relative;
        overflow: hidden;
    }

    .empty-state-advanced::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(102, 126, 234, 0.1) 0%, transparent 70%);
        animation: emptyFloat 20s ease-in-out infinite;
    }

    @keyframes emptyFloat {
        0%, 100% { transform: translate(0, 0) rotate(0deg); }
        33% { transform: translate(30px, -30px) rotate(120deg); }
        66% { transform: translate(-20px, 20px) rotate(240deg); }
    }

    .empty-icon {
        font-size: 5rem;
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        opacity: 0.8;
        animation: pulse 2s ease-in-out infinite;
    }

    /* é«˜çº§æ§åˆ¶é¢æ¿ */
    #advancedPanel {
        animation: slideDown 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }

    @keyframes slideDown {
        0% {
            opacity: 0;
            transform: translateY(-30px);
        }
        100% {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* æŒ‰é’®åŠ¨ç”» */
    .action-buttons {
        display: flex;
        gap: var(--space-sm);
        align-items: center;
    }

    /* é«˜çº§æœç´¢æ¡†ç„¦ç‚¹æ•ˆæœ */
    .search-advanced:focus-within {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
    }

    .search-advanced:focus-within .search-icon {
        color: var(--primary-color);
        transform: scale(1.1);
    }

    /* é¡µé¢å¤§å°é€‰æ‹©å™¨ */
    .page-size-selector {
        display: flex;
        align-items: center;
        gap: var(--space-sm);
    }

    .page-size-selector label {
        color: var(--text-secondary);
        font-weight: 500;
        margin: 0;
    }

    /* é«˜çº§åŠ¨ç”»ç±» */
    .fade-in-scale {
        opacity: 0;
        transform: scale(0.8);
        animation: fadeInScale 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
    }

    @keyframes fadeInScale {
        to {
            opacity: 1;
            transform: scale(1);
        }
    }

    /* æ‚¬æµ®å‘å…‰æ•ˆæœ */
    .hover-glow:hover {
        box-shadow:
            var(--glass-shadow),
            0 0 30px rgba(102, 126, 234, 0.4),
            0 0 60px rgba(102, 126, 234, 0.2);
        border-color: rgba(102, 126, 234, 0.6);
    }

    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 1024px) {
        .student-card-advanced:hover {
            transform: translateY(-10px) scale(1.01);
        }
    }

    @media (max-width: 768px) {
        .student-card-advanced {
            margin-bottom: var(--space-md);
        }

        .info-item {
            margin-bottom: var(--space-sm);
        }

        .stats-card {
            margin-bottom: var(--space-md);
        }

        .page-info {
            font-size: 0.875rem;
        }

        .pagination-advanced {
            flex-wrap: wrap;
            justify-content: center;
        }
    }

    @media (max-width: 576px) {
        .action-buttons {
            flex-direction: column;
            gap: var(--space-sm);
        }

        .btn-lg {
            width: 100%;
        }

        .student-card-advanced:hover {
            transform: translateY(-5px) scale(1);
        }

        .info-item:hover {
            transform: translateX(0);
        }
    }
</style>

<!-- é«˜çº§äº¤äº’è„šæœ¬ -->
{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // é«˜çº§æ§åˆ¶é¢æ¿åˆ‡æ¢
    window.toggleAdvancedPanel = function() {
        const panel = document.getElementById('advancedPanel');
        const isVisible = panel.style.display !== 'none';

        if (isVisible) {
            panel.style.animation = 'slideUp 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55)';
            setTimeout(() => {
                panel.style.display = 'none';
            }, 500);
        } else {
            panel.style.display = 'block';
            panel.style.animation = 'slideDown 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55)';
        }
    };

    // å®æ—¶æœç´¢
    const searchInput = document.getElementById('advancedSearch');
    const realtimeCheckbox = document.getElementById('realtimeSearch');
    let searchTimer;

    if (searchInput && realtimeCheckbox) {
        searchInput.addEventListener('input', function() {
            if (realtimeCheckbox.checked) {
                clearTimeout(searchTimer);
                searchTimer = setTimeout(() => {
                    performAdvancedSearch();
                }, 300);
            }
        });
    }

    // é«˜çº§æœç´¢åŠŸèƒ½
    function performAdvancedSearch() {
        const searchTerm = searchInput.value.toLowerCase();
        const statusFilter = document.getElementById('statusFilter').value;
        const genderFilter = document.getElementById('genderFilter').value;
        const studentCards = document.querySelectorAll('#studentsGrid .col-xl-4');

        studentCards.forEach(card => {
            const cardContent = card.textContent.toLowerCase();
            const matchesSearch = !searchTerm || cardContent.includes(searchTerm);

            // ç®€å•çš„çŠ¶æ€ç­›é€‰ï¼ˆå®é™…åº”ç”¨ä¸­éœ€è¦æ›´å¤æ‚çš„é€»è¾‘ï¼‰
            const matchesStatus = !statusFilter || cardContent.includes(statusFilter);
            const matchesGender = !genderFilter || cardContent.includes(genderFilter);

            if (matchesSearch && matchesStatus && matchesGender) {
                card.style.display = 'block';
                card.style.animation = 'fadeInScale 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55)';
            } else {
                card.style.display = 'none';
            }
        });

        // æ·»åŠ æœç´¢åŠ¨ç”»
        searchInput.parentElement.style.transform = 'scale(1.02)';
        setTimeout(() => {
            searchInput.parentElement.style.transform = 'scale(1)';
        }, 200);
    }

    // é¡µé¢å¤§å°æ›´æ”¹
    const pageSizeSelect = document.getElementById('pageSize');
    if (pageSizeSelect) {
        pageSizeSelect.addEventListener('change', function() {
            const currentUrl = new URL(window.location);
            currentUrl.searchParams.set('page_size', this.value);
            currentUrl.searchParams.set('page', '1');
            window.location.href = currentUrl.toString();
        });
    }

    // æ•°å­—åŠ¨ç”»
    function animateNumbers() {
        const counters = document.querySelectorAll('[data-count]');

        counters.forEach(counter => {
            const target = parseInt(counter.getAttribute('data-count'));
            const increment = target / 50;
            let current = 0;

            const timer = setInterval(() => {
                current += increment;
                if (current >= target) {
                    counter.textContent = target;
                    clearInterval(timer);
                } else {
                    counter.textContent = Math.floor(current);
                }
            }, 30);
        });
    }

    // é¡µé¢åŠ è½½å®Œæˆåå¯åŠ¨åŠ¨ç”»
    setTimeout(animateNumbers, 500);

    // é«˜çº§ç­›é€‰å™¨äº‹ä»¶
    const filters = ['statusFilter', 'genderFilter', 'sortBy'];
    filters.forEach(filterId => {
        const filter = document.getElementById(filterId);
        if (filter) {
            filter.addEventListener('change', performAdvancedSearch);
        }
    });

    // å¡ç‰‡æ‚¬åœæ•ˆæœå¢å¼º
    const studentCards = document.querySelectorAll('.student-card-advanced');
    studentCards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            // æ·»åŠ æ‚¬åœå£°æ•ˆï¼ˆå¯é€‰ï¼‰
            this.style.transition = 'all 0.4s cubic-bezier(0.4, 0.0, 0.2, 1)';
        });

        card.addEventListener('mouseleave', function() {
            this.style.transition = 'all 0.5s cubic-bezier(0.4, 0.0, 0.2, 1)';
        });
    });

    // é”®ç›˜å¿«æ·é”®
    document.addEventListener('keydown', function(e) {
        // Ctrl/Cmd + F èšç„¦æœç´¢æ¡†
        if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
            e.preventDefault();
            if (searchInput) {
                searchInput.focus();
                searchInput.select();
            }
        }

        // Ctrl/Cmd + K åˆ‡æ¢é«˜çº§é¢æ¿
        if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
            e.preventDefault();
            toggleAdvancedPanel();
        }

        // ESC å…³é—­é«˜çº§é¢æ¿
        if (e.key === 'Escape') {
            const panel = document.getElementById('advancedPanel');
            if (panel && panel.style.display !== 'none') {
                toggleAdvancedPanel();
            }
        }
    });

    // æ·»åŠ æ»‘åŠ¨åŠ¨ç”»æ ·å¼
    const style = document.createElement('style');
    style.textContent = `
        @keyframes slideUp {
            0% {
                opacity: 1;
                transform: translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateY(-30px);
            }
        }
    `;
    document.head.appendChild(style);

    // åˆå§‹åŒ–å·¥å…·æç¤º
    const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    const tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl, {
            template: '<div class="tooltip tooltip-advanced" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>'
        });
    });

    // æ€§èƒ½ç›‘æ§ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
    if (window.location.hostname === 'localhost') {
        console.log('ğŸš€ é«˜çº§å­¦ç”Ÿç®¡ç†ç³»ç»Ÿå·²åŠ è½½');
        console.log('âš¡ å¿«æ·é”®ï¼šCtrl+F æœç´¢ | Ctrl+K é«˜çº§é¢æ¿ | ESC å…³é—­é¢æ¿');

        // æ·»åŠ æ€§èƒ½ç›‘æ§
        const perfObserver = new PerformanceObserver((list) => {
            for (const entry of list.getEntries()) {
                console.log(`ğŸ“Š æ€§èƒ½æ•°æ®: ${entry.name} - ${entry.duration.toFixed(2)}ms`);
            }
        });

        perfObserver.observe({ entryTypes: ['measure', 'navigation'] });
    }
});
</script>
{% endblock %}
{% endblock %}