{% extends 'base-minimal.html' %}
{% load static %}

{% block title %}å­¦ç”Ÿæ¡£æ¡ˆåˆ—è¡¨ - å­¦ç”Ÿç®¡ç†ç³»ç»Ÿ{% endblock %}

{% block content %}
<div style="max-width: 1200px; margin: 2rem auto; padding: 0 1rem;">
    <!-- é¡µé¢æ ‡é¢˜ -->
    <div class="page-header">
        <h1 class="page-title">å­¦ç”Ÿæ¡£æ¡ˆåˆ—è¡¨</h1>
        <div class="page-actions">
            {% if user.role == 'admin' %}
                <a href="{% url 'students:student_profile_create' %}" class="btn btn-primary">
                    æ·»åŠ å­¦ç”Ÿæ¡£æ¡ˆ
                </a>
            {% endif %}
        </div>
    </div>

    <!-- æœç´¢æ¡† -->
    <div class="search-box">
        <form method="get" class="w-100">
            <input type="text"
                   name="q"
                   class="form-control"
                   placeholder="æœç´¢å­¦ç”Ÿå§“åã€å­¦å·æˆ–é™¢ç³»..."
                   value="{{ request.GET.q }}">
        </form>
    </div>

    <!-- ç»Ÿè®¡ä¿¡æ¯ -->
    {% if user.role == 'admin' %}
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
        <div class="card" style="text-align: center;">
            <div style="padding: 1.5rem;">
                <div style="font-size: 2rem; font-weight: 700; color: var(--primary);">
                    {{ students.count }}
                </div>
                <div style="color: var(--text-secondary);">æ€»å­¦ç”Ÿæ•°</div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- å­¦ç”Ÿåˆ—è¡¨ -->
    {% if students %}
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 1.5rem;">
            {% for student in students %}
                <div class="card">
                    <div style="padding: 1.5rem;">
                        <!-- å­¦ç”ŸåŸºæœ¬ä¿¡æ¯ -->
                        <div style="display: flex; align-items: center; margin-bottom: 1rem;">
                            <div style="width: 60px; height: 60px; border-radius: 50%; background: var(--bg-secondary); display: flex; align-items: center; justify-content: center; margin-right: 1rem; font-size: 1.5rem;">
                                {% if student.user.get_full_name %}
                                    {{ student.user.get_full_name.0 }}
                                {% else %}
                                    {{ student.user.username.0|upper }}
                                {% endif %}
                            </div>
                            <div>
                                <h3 style="margin: 0; color: var(--text-primary); font-size: 1.1rem;">
                                    {{ student.real_name|default:student.user.username }}
                                </h3>
                                <p style="margin: 0.25rem 0; color: var(--text-secondary); font-size: 0.9rem;">
                                    å­¦å·: {{ student.student_id|default:'æœªè®¾ç½®' }}
                                </p>
                            </div>
                        </div>

                        <!-- è¯¦ç»†ä¿¡æ¯ -->
                        <div style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.5;">
                            {% if student.department %}
                                <p style="margin: 0.25rem 0;">
                                    ğŸ¢ {{ student.department.name }}
                                </p>
                            {% endif %}
                            {% if student.major %}
                                <p style="margin: 0.25rem 0;">
                                    ğŸ“š {{ student.major.name }}
                                </p>
                            {% endif %}
                            {% if student.gender %}
                                <p style="margin: 0.25rem 0;">
                                    ğŸ‘¤ {% if student.gender == 'M' %}ç”·{% elif student.gender == 'F' %}å¥³{% else %}å…¶ä»–{% endif %}
                                </p>
                            {% endif %}
                            {% if student.birth_date %}
                                <p style="margin: 0.25rem 0;">
                                    ğŸ“… {{ student.birth_date }}
                                </p>
                            {% endif %}
                            <p style="margin: 0.25rem 0;">
                                ğŸ“§ {{ student.user.email|default:'æœªè®¾ç½®é‚®ç®±' }}
                            </p>
                        </div>

                        <!-- æ“ä½œæŒ‰é’® -->
                        <div class="table-card-actions" style="margin-top: 1rem;">
                            {% if user.role == 'admin' %}
                                <a href="{% url 'students:student_profile_update' student.id %}" class="btn btn-sm btn-outline">
                                    ç¼–è¾‘
                                </a>
                                <a href="{% url 'students:student_profile_delete' student.id %}" class="btn btn-sm btn-danger">
                                    åˆ é™¤
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <!-- ç©ºçŠ¶æ€ -->
        <div class="empty-state">
            <h3>æ²¡æœ‰æ‰¾åˆ°å­¦ç”Ÿæ¡£æ¡ˆ</h3>
            <p>
                {% if request.GET.q %}
                    æ²¡æœ‰æ‰¾åˆ°åŒ…å« "{{ request.GET.q }}" çš„å­¦ç”Ÿæ¡£æ¡ˆã€‚
                {% else %}
                    ç³»ç»Ÿä¸­è¿˜æ²¡æœ‰å­¦ç”Ÿæ¡£æ¡ˆã€‚
                {% endif %}
            </p>
            {% if user.role == 'admin' and not request.GET.q %}
                <a href="{% url 'students:student_profile_create' %}" class="btn btn-primary">
                    æ·»åŠ ç¬¬ä¸€ä¸ªå­¦ç”Ÿæ¡£æ¡ˆ
                </a>
            {% endif %}
        </div>
    {% endif %}
</div>
{% endblock %}